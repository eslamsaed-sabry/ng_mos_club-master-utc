<mat-drawer-container class="example-container" autosize>

  <div class="page-title">
    <h4 class="mo-font-bold mo-m-0"> {{'navigation.packages' | translate}} </h4>

    <div class="actions">
      <mat-form-field appearance="outline">
        <mat-label>{{'members.search' | translate}}</mat-label>
        <input matInput #inputSearch [(ngModel)]="searchKey" name="searchKey" type="text"
          (input)="onSearchInput(inputSearch.value)" placeholder="{{'members.search' | translate}}" />
        </mat-form-field>
        <mat-form-field class="mo-mx-2">
          <mat-label>{{'members.packageType' | translate}}</mat-label>
          <mat-select [(ngModel)]="selectedPackageType" name="selectedPackageType" (selectionChange)="applyFilter()">
            <mat-option [value]="-1">{{'members.all' | translate}}</mat-option>
            @for (el of packageTypes; track el) {
              <mat-option [value]="el.id">{{el.name}}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        <mat-checkbox class="mo-mx-2" (change)="applyFilter()" [(ngModel)]="isActive" name="isActive">
        {{'staff.isActive' | translate}}</mat-checkbox>
        <button *appRole="['packages','tsb_Add']" color="primary" (click)="addPackage()" mat-raised-button>
          <mat-icon>add</mat-icon> {{'members.add' | translate}} {{'members.package' | translate}}
        </button>
      </div>
    </div>

    <div>
      <div class="table-responsive card p-3">
        <table mat-table [dataSource]="dataSource" matSort>
          <ng-container matColumnDef="packageTypeName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'members.packageType' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.packageTypeName}}</td>
          </ng-container>

          <ng-container matColumnDef="nameEng">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'members.englishName' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.nameEng}}</td>
          </ng-container>

          <ng-container matColumnDef="nameAR">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'members.arabicName' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.nameAR }}</td>
          </ng-container>

          <ng-container matColumnDef="duration">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'packages.duration' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.duration }}</td>
          </ng-container>

          <ng-container matColumnDef="durationType">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'packages.durationType' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.durationType }}</td>
          </ng-container>

          <ng-container matColumnDef="validDurationForUpgrade">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'packages.validDurationForUpgrade' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.validDurationForUpgrade }}</td>
          </ng-container>
          <ng-container matColumnDef="attendanceCount">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'packages.attendanceCount'|translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.attendanceCount }}</td>
          </ng-container>

          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'members.price'|translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.price }}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'members.status' | translate}}</th>
            <td mat-cell *matCellDef="let row">
            {{ row.isActive ? ('administration.active'|translate): ('administration.notActive'|translate) }}</td>
          </ng-container>

          <ng-container matColumnDef="changeStatus">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'administration.changeStatus' | translate}}</th>
            <td mat-cell *matCellDef="let row">
              <mat-slide-toggle (toggleChange)="toggleStatus(row)" color="primary" [(ngModel)]="row.isActive"
                name="isActive">
                <!-- <small>{{row.isActive ? ('administration.deactivate'|translate) : ('administration.activate'|translate)}}</small> -->
              </mat-slide-toggle>
            </td>
          </ng-container>

          <ng-container matColumnDef="showToMembers">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'packages.showToMembers'|translate}}</th>
            <td mat-cell *matCellDef="let row">
              <div class="mo-text-center">
                @if (row.showToMembers) {
                  <mat-icon class="text-success">check_circle</mat-icon>
                }
                @if (!row.showToMembers) {
                  <mat-icon class="mo-text-error-500">highlight_remove</mat-icon>
                }
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="minFreeze">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'packages.minFreeze'|translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.minFreeze }}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="mo-text-center">
              <mat-icon>settings</mat-icon>
            </th>
            <td mat-cell *matCellDef="let row" class="mo-text-center">
              <button mat-button (click)="$event.stopPropagation()" [matMenuTriggerFor]="actionMenu">
                <mat-icon>more_horiz</mat-icon>
              </button>
              <mat-menu #actionMenu="matMenu" class="action-menu">
                <button (click)="editPackage(row)" *appRole="['packages', 'tsb_Save']" mat-menu-item>
                  <mat-icon>edit_note</mat-icon>
                  {{'members.edit' | translate}}
                </button>

                @if (!row.isDeleted) {
                  <button [appRoleAttr]="['packages', 'tsb_Remove']" (click)="onDeletePackage(row)"
                    mat-menu-item class="mo-text-error-500">
                    <mat-icon>delete_sweep</mat-icon>
                    {{'members.delete' | translate}}
                  </button>
                }
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row [ngClass]="{'deleted' : row.isDeleted}" *matRowDef="let row; columns: displayedColumns"></tr>

          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="9">{{'members.noData' | translate}}</td>
          </tr>
        </table>

        <mat-paginator (page)="onPaginationChange($event)" [pageSize]="perPage" [pageIndex]="page"
          [length]="totalElements" [pageSizeOptions]="[10, 25, 100]" aria-label="Select page of users">
        </mat-paginator>
      </div>
    </div>
  </mat-drawer-container>