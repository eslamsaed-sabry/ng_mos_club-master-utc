<div mat-dialog-title>
  <span class="mo-font-bold">{{data.type === 'addSession' ? ('dashboard.addOnePassServices' | translate) :
  ('dashboard.editOnePassServices' | translate)}}</span>
  @if (session.price) {
    <h6 class="badge mo-bg-info-500 mo-mx-2"> Price &nbsp;<strong>{{session.price}}</strong></h6>
  }
  @if (data.type === 'editSession') {
    <h6 class="badge bg-primary"> {{'reports.table.paymentMethod'|translate}}
      &nbsp;<strong>{{session.isCash ? 'Cash' : 'Visa'}}</strong></h6>
    }
    @if (data.type=='addSession') {
      <div class="mo-font-bold mo-text-center">
        <label class="fs-6">{{'common.yourCurrentBranch' | translate}}{{branchName}}</label>
      </div>
    }
  </div>

  <form (ngSubmit)="addSession(sessionForm)" #sessionForm="ngForm">

    <div mat-dialog-content>
      <div class="row">
        <div class="col-12" *appRole="['sessions', 'dtp_Date']">
          <!-- <mat-form-field class="mo-w-full" (click)="sessionDatepicker.open()" appearance="outline">
          <mat-label>{{'members.sessionDateTime' | translate}}</mat-label>
          <input matInput [matDatepicker]="sessionDatepicker" [max]="today" [(ngModel)]="session.sessionDate"
            name="sessionDate" />
            <mat-datepicker-toggle matSuffix [for]="sessionDatepicker"></mat-datepicker-toggle>
            <mat-datepicker #sessionDatepicker></mat-datepicker>
          </mat-form-field> -->

          <mat-form-field appearance="outline" class="mo-w-full">
            <mat-label>{{'members.sessionDateTime' | translate}}</mat-label>
            <input matInput type="datetime-local" [(ngModel)]="session.sessionDate" name="sessionDate" required>
          </mat-form-field>
        </div>

        <!-- <div class="col-md-6 col-12" *ngIf="session.sessionDate">
        <ngx-timepicker-field [defaultTime]="time" (timeChanged)="getTime($event)"></ngx-timepicker-field>
      </div> -->

      <div class="col-12">
        <mat-form-field class="mo-w-full" appearance="outline">
          <mat-label>{{'reports.table.type' | translate}}</mat-label>
          <mat-select [(ngModel)]="session.typeId" name="typeId" required (selectionChange)="onSelectPrice()">
            @for (el of sessionTypes; track el) {
              <mat-option [value]="el.id">{{el.englishName}}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

    </div>

    <div class="row">
      <div class="col-md-4">
        <mat-form-field class="mo-w-full" appearance="outline">
          <mat-label>{{'members.countryCode'|translate}}</mat-label>
          <mat-select (selectionChange)="common.validatePhoneNumber(session.phone,session.phoneFormatId,countryCodes)"
            [(ngModel)]="session.phoneFormatId" name="phoneFormatId" required>
            @for (c of countryCodes; track c) {
              <mat-option [value]="c.id">{{c.displayName}}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-md-8">
        <mat-form-field class="mo-w-full" appearance="outline">
          <mat-label>{{'members.phone' | translate}}</mat-label>
          <input matInput [(ngModel)]="session.phone" (blur)="searchPhone()" name="phoneNo" required
            [disabled]="disablePhone" />
            @if (phoneTypeAheadLoading) {
              <mat-spinner matSuffix [diameter]="20"></mat-spinner>
            }
          </mat-form-field>
        </div>
      </div>

      <div class="row">
        <div class="col-12">
          <mat-form-field class="mo-w-full" appearance="outline">
            <mat-label>{{'reports.table.name' | translate}}</mat-label>
            <input matInput [(ngModel)]="session.name" name="name" required [disabled]="disableName" />
          </mat-form-field>
        </div>

        <div class="col-12">
          <mat-form-field class="mo-w-full" appearance="outline">
            <mat-label>{{'members.gender' | translate}}</mat-label>
            <mat-select [(ngModel)]="session.gender" name="gender" required [disabled]="disableName">
              <mat-option [value]="gender.MALE">{{'members.male' | translate}}</mat-option>
              <mat-option [value]="gender.FEMALE">{{'members.female' | translate}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="col-12" *appRole="['sessions','ChooseSalesPerson']">
          <mat-form-field class="mo-w-full" appearance="outline">
            <mat-label>{{'members.salesPerson' | translate}}</mat-label>
            <mat-select [(ngModel)]="session.salesPersonId" name="salesPersonId">
              @for (el of sales; track el) {
                <mat-option [value]="el.id">{{el.name}}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <div class="col-12" *appRole="['sessions', 'Edit']">
          <mat-form-field class="mo-w-full" appearance="outline">
            <mat-label>{{'members.price' | translate}}</mat-label>
            <input matInput [(ngModel)]="session.price" name="price" required />
          </mat-form-field>
        </div>

        @if (data.type != 'editSession') {
          <div class="col-12 mo-my-3">
            <label class="mo-font-bold">{{'receiptPrint.paymentMethod' | translate}}</label>
            <mat-radio-group class="mo-mx-3" (change)="validate()" [(ngModel)]="session.isCash" name="packageType" required>
              <mat-radio-button [value]="true" selected>{{'receiptPrint.cash' | translate}}</mat-radio-button>
              <mat-radio-button [value]="false" selected>{{'receiptPrint.visa' | translate}}</mat-radio-button>
            </mat-radio-group>
            @if (paymentMethodErr) {
              <mat-error><small>{{'common.pleaseSelectPaymentMethod' | translate}}</small>
            </mat-error>
          }
        </div>
      }

      @if (data.type === 'editSession') {
        <div class="col-12 mo-my-3" [appRoleAttr]="['sessions','ChangeVisaType']">
          <label class="mo-font-bold">{{'receiptPrint.paymentMethod' | translate}}</label>
          <mat-radio-group class="mo-mx-3" aria-label="Select Payment method" (change)="validate()"
            [(ngModel)]="session.isCash" name="packageType" required>
            <mat-radio-button [value]="true" selected>{{'receiptPrint.cash' | translate}}</mat-radio-button>
            <mat-radio-button [value]="false" selected>{{'receiptPrint.visa' | translate}}</mat-radio-button>
          </mat-radio-group>
          @if (paymentMethodErr) {
            <mat-error><small>{{'common.pleaseSelectPaymentMethod' | translate}}</small>
          </mat-error>
        }
      </div>
    }

    @if (!session.isCash) {
      <div class="col-12">
        <mat-form-field class="mo-w-full" appearance="outline">
          <mat-label>{{'members.visaType' | translate}}</mat-label>
          <mat-select [(ngModel)]="session.visaTypeId" name="visaTypeId" required>
            @for (v of visaTypes; track v) {
              <mat-option [value]="v.id">{{v.name}}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    }

    @if (isShowReceiptNo) {
      <div class="col-12">
        <mat-form-field class="mo-w-full" appearance="outline">
          <mat-label>{{'members.receiptNo' | translate}}</mat-label>
          <input matInput [(ngModel)]="session.receiptNo" name="receiptNo" required />
        </mat-form-field>
      </div>
    }

    @if (data.type == 'addSession') {
      <div class="col-12 mo-mt-2">
        <mat-checkbox [(ngModel)]="isPrint" name="isPrint">{{'members.printRec' | translate}}</mat-checkbox>
      </div>
    }

    <!--
    <div class="col-12 mo-mt-2">
      <mat-checkbox>Print reciept</mat-checkbox>
    </div> -->
  </div>
</div>

<div mat-dialog-actions>
  <button mat-button type="button" (click)="dismiss()">{{'members.cancel' | translate}}</button>
  @if (data.type === 'addSession') {
    <button mat-raised-button [disabled]="phoneTypeAheadLoading" color="primary"
      type="submit">
      {{'members.save' | translate}}
    </button>
  }
  @if (data.type === 'editSession') {
    <button mat-raised-button [disabled]="phoneTypeAheadLoading" color="primary" (click)="editSession(sessionForm)"
      type="button">
      {{'members.save' | translate}}
    </button>
  }
</div>
</form>