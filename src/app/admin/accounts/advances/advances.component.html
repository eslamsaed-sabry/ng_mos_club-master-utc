<div class="page-title">
  <h4 class="mo-font-bold mo-m-0"> {{'navigation.advances' | translate}} </h4>

  <div class="actions">

    <div class="mo-flex mo-flex-wrap mo-items-baseline mo-pe-3">
      <div>
        <mat-form-field class="mo-w-full" (click)="fromDatepicker.open()">
          <mat-label>{{'reports.table.fromDate' | translate}}</mat-label>
          <input (dateChange)="applyFilter()" matInput [matDatepicker]="fromDatepicker" [(ngModel)]="filters.from"
            name="fromDate" required />
            <mat-datepicker-toggle matSuffix [for]="fromDatepicker"></mat-datepicker-toggle>
            <mat-datepicker #fromDatepicker startView="year"></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="mo-px-2">
          <mat-form-field class="mo-w-full" (click)="toDatepicker.open()">
            <mat-label>{{'reports.table.toDate' | translate}}</mat-label>
            <input matInput (dateChange)="applyFilter()" [matDatepicker]="toDatepicker" [(ngModel)]="filters.to"
              name="toDate" required />
              <mat-datepicker-toggle matSuffix [for]="toDatepicker"></mat-datepicker-toggle>
              <mat-datepicker #toDatepicker startView="year"></mat-datepicker>
            </mat-form-field>
          </div>

          <div>
            <mat-form-field class="mo-w-full">
              <mat-label>{{'staff.staffMember' | translate}}</mat-label>
              <mat-select (selectionChange)="applyFilter()" [(ngModel)]="filters.staffMemberId" name="staffMemberId">
                @for (c of staffMembers; track c) {
                  <mat-option [value]="c.id">{{c.name}}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <button *appRole="['advances','tsb_Add']" color="primary" (click)="addAdvances()" mat-raised-button>
          <mat-icon>add</mat-icon> {{'accounts.addAdvance' | translate}}
        </button>
      </div>
    </div>


    <div>
      <div class="table-responsive card p-3">
        <table mat-table [dataSource]="dataSource" matSort>
          <ng-container matColumnDef="actionDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'reports.table.date' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.actionDate | date:'MMM d, y, h:mm a'}}</td>
          </ng-container>

          <ng-container matColumnDef="staffMemberName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'staff.staffMember' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.staffMemberName }}</td>
          </ng-container>

          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'accounts.amount' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.price }}</td>
          </ng-container>

          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'reports.table.description' | translate}}</th>
            <td mat-cell *matCellDef="let row">{{ row.description }}</td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="mo-text-center">
              <mat-icon>settings</mat-icon>
            </th>
            <td mat-cell *matCellDef="let row" class="mo-text-center">
              <button mat-button (click)="$event.stopPropagation()" [matMenuTriggerFor]="actionMenu">
                <mat-icon>more_horiz</mat-icon>
              </button>
              <mat-menu #actionMenu="matMenu" class="action-menu">
                <button (click)="editAdvances(row)" *appRole="['advances', 'tsb_Save']"
                  mat-menu-item><mat-icon>edit_note</mat-icon>
                {{'members.edit' | translate}}</button>

                @if (!row.isDeleted) {
                  <button [appRoleAttr]="['advances', 'tsb_Save']" (click)="getReceiptType(row)"
                    mat-menu-item>
                    <mat-icon>print</mat-icon>
                    {{'reports.print' | translate}}
                  </button>
                }

                <button mat-menu-item *appRole="['advances','ChangePaymentBranch']" (click)="changePaymentBranch(row)">
                  <mat-icon>business</mat-icon> {{'members.changePaymentBranch' | translate}}
                </button>

                @if (!row.isDeleted) {
                  <button [appRoleAttr]="['advances', 'tsb_Remove']" (click)="onDeleteAdvances(row)"
                    mat-menu-item class="mo-text-error-500"><mat-icon>delete_sweep</mat-icon>
                  {{'members.delete' | translate}}</button>
                }
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="9">{{'members.noData' | translate}}</td>
          </tr>
        </table>

        <mat-paginator (page)="onPaginationChange($event)" [pageSize]="filters.takeCount" [pageIndex]="page"
          [length]="totalElements" [pageSizeOptions]="[10, 25, 100]">
        </mat-paginator>
      </div>
    </div>