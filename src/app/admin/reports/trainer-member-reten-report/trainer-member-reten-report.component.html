<app-reports-page-header [permissions]="['trainerReport', 'tsb_Print', 'Export']"
  [reportName]="'reports.trainerMemberRetentionReport'|translate" [isResult]="isResult" (onAction)="getAction($event)">
</app-reports-page-header>

<div class="row printable-report">
  <div class="col-xl-3 col-md-4 col-12 print-filter">
    <app-trainer-member-reten-report-filters [filters]="filters"></app-trainer-member-reten-report-filters>
  </div>

  @if (isResult) {
    <div class="col-12" [ngClass]="{'col-xl-9 col-md-8': !onPrint}">
      <div class="reports-tabs-container mo-mt-4">
        <div class="table-responsive" id="receipts">
          <mat-accordion multi>
            @for (group of groupedSessions; track group) {
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <ul class="mo-flex mo-gap-5 mo-w-full">
                      <li>
                        {{'reports.table.coach' | translate}}: <strong class="mo-ps-1">{{group.coachName}}</strong>
                      </li>
                      <li class="mo-min-w-[40%]">
                        {{'reports.table.memberName' | translate}}: <strong class="mo-ps-1">{{group.memberName}}</strong>
                      </li>
                      <li class="mo-ms-auto">
                        {{'members.membershipsCount' | translate}}: <strong
                      class="mo-ps-1">{{group.sessions.length}}</strong>
                    </li>
                  </ul>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>{{'reports.table.paymentDate' | translate}}</th>
                    <th>{{'reports.table.coach' | translate}}</th>
                    <th>{{'members.contractNo' | translate}}</th>
                    <th>{{'members.memberEnglishName' | translate}}</th>
                    <th>{{'members.packageName' | translate}}</th>
                    <th>{{'reports.table.attendedTimes' | translate}}</th>
                  </tr>
                </thead>
                <tbody>
                  @for (el of group.sessions; track el) {
                    <tr matTooltipPosition="left">
                      <td class="mo-text-center">{{el.paymentDate | date:'MMM d, y, h:mm a'}}</td>
                      <td class="mo-text-center">{{el.coachName}}</td>
                      <td class="mo-text-center">{{el.contractNo}}</td>
                      <td class="mo-text-center">{{el.memberEnglishName}}</td>
                      <td class="mo-text-center">{{el.packageName}}</td>
                      <td class="mo-text-center">{{el.attendedTimes}}</td>
                    </tr>
                  }
                  @if (group && group.sessions.length === 0) {
                    <tr>
                      <td colspan="10">{{'members.noData' | translate}}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </mat-expansion-panel>
          }
        </mat-accordion>
        <!-- <table class="table table-striped">
        <thead>
          <tr>
            <th>{{'members.trainerName' | translate}}</th>
            <th>{{'reports.table.successfulSales' | translate}}</th>
            <th>{{'reports.table.totalOpportunities' | translate}}</th>
            <th>{{'reports.table.ratio' | translate}}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let el of reports" matTooltipPosition="left">
            <td class="mo-text-center">{{el.trainerName}}</td>
            <td class="mo-text-center">{{el.successfulSales}}</td>
            <td class="mo-text-center">{{el.totalOpportunities}}</td>
            <td class="mo-text-center">{{el.ratio}}</td>
          </tr>
          <tr *ngIf="reports?.length === 0">
            <td colspan="10">{{'members.noData' | translate}}</td>
          </tr>
        </tbody>
      </table> -->
    </div>
  </div>
</div>
}
</div>